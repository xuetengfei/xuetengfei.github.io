## Wireshark 抓包 TCP 流

http 协议
![20220327-d5nl7d-1575991122_5defb7522c89f](https://loremxuetengfei.oss-cn-beijing.aliyuncs.com/20220327-d5nl7d-1575991122_5defb7522c89f.jpg)
https 协议
![20220327-74HkaP-1575991561_5defb90954dd8](https://loremxuetengfei.oss-cn-beijing.aliyuncs.com/20220327-74HkaP-1575991561_5defb90954dd8.jpg)

## 私钥算法

私钥加密算法，又称对称加密算法

因为这种算法解密密钥和加密密钥是相同的。也正因为同一密钥既用于加密又用于解密，所
以这个密钥是不能公开的。常见的有《DES 加密算法》、《AES 加密算法》。

对称加密 Symmetric Encryption 有一个密钥，它可以对一段内容加密，加密后只能用它才
能解密看到原本的内容，和日常生活中用的钥匙作用差不多。

<img src='https://loremxuetengfei.oss-cn-beijing.aliyuncs.com/uPic/symmetric-encryption-SF6lWU.jpg' alt='symmetric-encryption-SF6lWU'/>

## 公钥算法

公钥加密算法，也就是非对称加密算法

这种算法加密和解密的密码不一样，一个是公钥，另一个是私钥：

公钥和私钥成对出现公开的密钥叫公钥，只有自己知道的叫私钥用公钥加密的数据只有对应
的私钥可以解密用私钥加密的数据只有对应的公钥可以解密如果可以用公钥解密，则必然是
对应的私钥加的密如果可以用私钥解密，则必然是对应的公钥加的密公钥和私钥是相对的，
两者本身并没有规定哪一个必须是公钥或私钥。

<img src='https://loremxuetengfei.oss-cn-beijing.aliyuncs.com/20200715-k6YBkL-加密.jpg' alt='20200715-k6YBkL-加密'/>

## 实现数据的安全传输

因为 http 的内容是明文传输的，明文数据会经过中间代理服务器、路由器、wifi 热点、
通信服务运营商等多个物理节点，如果信息在传输过程中被劫持，传输的内容就完全暴露了
，他还可以篡改传输的信息且不被双方察觉，这就是中间人攻击。所以才需要对信息进行加
密。最简单容易理解的就是对称加密 。

要实现数据的安全传输，当然就要对数据进行加密了。

## 不能使用对称加密

如果使用`对称加密算法`，加解密使用同一个密钥，除了自己保存外，对方也要知道这个密
钥，才能对数据进行解密。如果你把密钥也一起传过去，就存在密码泄漏的可能。

## 如果使用非对称加密

使用`非对称加密`，过程如下：

```bash
1. 首先 服务器 生成一对密钥，即私钥和公钥；
2. 然后，服务器 将公钥发送给 浏览器；
3. 浏览器用收到的公钥对数据加密，再发送给接收方；
4. 服务器收到数据后，使用自己的私钥解密。
```

由于在非对称算法中，公钥加密的数据必须用对应的私钥才能解密，而私钥又只有接收 方
自己知道，这样就保证了数据传输的安全性。

### 公钥算法的缺点

公钥机制也有它的缺点，那就是**效率非常低**，比常用的私钥算法（如 DES 和 AES）慢
上一两个数量级都有可能。所以它不适合为大量的原始信息进行加密。为了同时兼顾安全和
效率，我们通常结合使用公钥算法和私钥算法：

## 兼顾安全和效率

为了同时兼顾安全和效率，我们通常结合使用公钥算法和私钥算法：

```bash
1.  首先，浏览器使用对称算法得到一个私钥(会话密钥)。
2.  服务器通过公钥机制生成一对密钥，一个公钥，一个私钥。
3.  服务器 将公钥发送给 浏览器。
4.  浏览器用公钥对第一步的自己算出的私钥进行加密，并发送给服务器。
5.  服务器用私钥进行解密得到对称算法的密钥。
6.  浏览器再把已加密的原始信息发送给服务器。
7.  服务器使用对称算法的密钥进行解密。
```

?> 简单明了地说,TLS 实际用的是两种算法的混合加密,利用非对称加密把浏览器私钥给服
务器，保证安全后，再使用对称加密进行传输数据，这样就可以保证效率。

## 数字证书

网站在使用 HTTPS 前，需要向 CA 机构申领一份数字证书，数字证书里含有证书持有者信
息、公钥信息等。服务器把证书传输给浏览器，浏览器从证书里获取公钥就行了，证书就如
身份证，证明“该公钥对应该网站”。而这里又有一个显而易见的问题，“证书本身的传输过
程中，如何防止被篡改”？即如何证明证书本身的真实性？身份证运用了一些防伪技术，而
数字证书怎么防伪呢？数字签名。

![20220327-LYeLVu-Xnip2022-03-27_19-58-55](https://loremxuetengfei.oss-cn-beijing.aliyuncs.com/20220327-LYeLVu-Xnip2022-03-27_19-58-55.jpg)

<!--
HTTPS协议需要到CA申请证书，一般免费证书很少，需要交费。
HTTP协议运行在TCP之上，所有传输的内容都是明文，HTTPS运行在SSL/TLS之上，SSL/TLS运行在TCP之上，所有传输的内容都经过加密的。
HTTP和HTTPS使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。
HTTPS可以有效的防止运营商劫持，解决了防劫持的一个大问题。

 -->

---

1. [What happens in a TLS handshake? | SSL handshake | Cloudflare](https://www.cloudflare.com/zh-cn/learning/ssl/what-happens-in-a-tls-handshake/)
2. [由 HTTPS 抓包引发的一系列思考 - FreeBuf 网络安全行业门户](https://www.freebuf.com/articles/web/222564.html)

<!--
[【第2560期】彻底搞懂HTTPS的加密原理](https://mp.weixin.qq.com/s/I5yezHTrObblrBGAoAEGkQ)
 -->
